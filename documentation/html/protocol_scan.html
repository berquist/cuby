<html>
	<head>
		<meta http-equiv="content-type" content="text/html; charset=utf-8" />
		<title>Cuby 4</title>
		<link href='http://fonts.googleapis.com/css?family=Ubuntu:400,300,500,300italic,400italic,500italic' rel='stylesheet' type='text/css'>
		<link rel="stylesheet" title="Default" href="layout.css">
		<link rel="stylesheet" title="Default" href="style.css">
		<link rel="stylesheet" title="Default" href="form.css">

		<link rel="stylesheet" title="Default" href="highlight.css">
		<script src="highlight.js"></script>
		<script src="yaml.js"></script>
		<script>hljs.initHighlightingOnLoad();</script>
	</head>
	<body>
		<div id="menu">
			<a href="index.html">Introduction</a>
			<a href="authors.html">Authors</a>
			<a href="download.php">Download</a>
			<a href="installation.html">Installation</a>
			<a href="getting_started.html">Getting started</a>
			<a href="useful_tips.html">Useful tips</a>
			<span class="menusection">Reference:
			<a href="keywords.html">Keywords</a>
			<a href="protocols.html">Protocols</a>
			<a href="interfaces.html">Interfaces</a>
			<a href="methods.html">Methods</a>
			<a href="input.html">Input file</a>
			<a href="geometry.html">Geometry</a>
			<a href="atom_selection.html">Atom selection</a>
			<a href="commandline.html">Commandline</a>
			<a href="queue_systems.html">Cuby on clusters</a>
			</span>
			<hr />
		</div>
		<div id="contents">
		<div id="contents-inner">
<h1>Protocol scan</h1>
<p>This protocol automates repeating calculations along a series of geometries (geometry keyword should point to .xyz file with multiple entries).</p>
<h2>Scan modes</h2>
<p>Two different scan modes are available:</p>
<ul>
	<li><strong>Parallel</strong> - All the calculations are prepared separately and then run using Cuby's internal queue system. Only after all calculations finish, the results are printed. The points can be calculated in parallel using the <a href="keywords.html#cuby_threads">cuby_threads</a> keyword.</li>
	<li><strong>Serial</strong> - One calculation is set up and then called repeatedly while updating the geometry. Therefore, it can use the previous result as a starting point (if the interface supports that). The results are printed to the output one by one as they are calculated. Additionally, if a calculation fails in this mode, a message is printed and the program continues moves to the next point.</li>
</ul>

<h2>Geometry file</h2>
<p>The geometry file should be an .xyz wile with multiple entries. A following extension is implemented: if the comment (second line) in the .xyz file starts with "scan:", the rest of the line is printed in the cuby output before each result. If the value of the scanned coordinate is used, the output then becomes a nice table ready for processing / plotting.</p>

<h2>Scan generators</h2>
<p>
Optionally, the scan can be generated by Cuby. The generator is called using keyword <a href="keywords.html#scan_generator">scan_generator</a> and set up using keyword <a href="keywords.html#scan_generator_setup">scan_generator_setup</a>. Following generators are avilable:
</p>
<ul>
	<li><strong>grid_xyz</strong> - the selected part of the geometry is moved to points on a cartesian grid (the center of the selection is positioned at the new coordinates). Moreover, the points are filtered by van der Waals distance, points with contact between the moved part and the rest of the system shorter than rvdw_min and longer than rvdw_max are removed (these values are relative to the vdW equilibrium distance).</li>
</ul>
<p>
Examples are provided below for each generator.
</p>

<h2>Input structure</h2>
<h4>The protocol requires following blocks in the input:</h4>
<ul>
<li>calculation - Setup for the calculation</li>
</ul>
<h2>Keywords used</h2>
<h4>Keywords specific for this protocol:</h4>
<ul>
<li><a href="keywords.html#geometry_template">geometry_template</a></li>
<li><a href="keywords.html#scan_generator">scan_generator</a></li>
<li><a href="keywords.html#scan_generator_batchsize">scan_generator_batchsize</a></li>
<li><a href="keywords.html#scan_generator_setup">scan_generator_setup</a></li>
<li><a href="keywords.html#scan_mode">scan_mode</a></li>
<li><a href="keywords.html#scan_print_mode">scan_print_mode</a></li>
</ul>
<h4>Other keywords used by this protocol:</h4>
<ul>
<li><a href="keywords.html#geometry">geometry</a></li>
</ul>
<h2>Examples</h2>
<p>The following examples, along with all other files needed to run them, can be found in the directory cuby4/protocols/scan/examples</p>
<div class="example"><pre><code>#===============================================================================
# Scan protocol example 1: simple energy scan
#===============================================================================

job: scan

# The geometry is an .xyz file containing a series of geometries, in this case
# a scan of a stretching vibrational mode
# The file contains the identifier "scan:" and the value of the scanned coordinate
# which is then printed in the output (this is optional).
geometry: water_stretch_scan.xyz

# Scan mode - serial/parallel
scan_mode: serial

# The calculation performed on each geometry
calculation:
  job: energy
  interface: mopac
  method: pm6
  charge: 0
</code></pre></div>
<p>Produces output:</p>
<div class="ex_output"><pre>        _______  
       /\______\ 
      / /      / 
     / / Cuby /   Scan
     \/______/   
                 
0.000000	Energy:           -54.130770 kcal/mol
0.447214	Energy:           -53.664500 kcal/mol
0.894427	Energy:           -52.269720 kcal/mol
1.341641	Energy:           -49.956900 kcal/mol
1.788854	Energy:           -46.736690 kcal/mol
2.236068	Energy:           -42.607440 kcal/mol
2.683282	Energy:           -37.530230 kcal/mol

</pre></div>
<div class="example"><pre><code>#===============================================================================
# Scan protocol example 2: Use of template geometry
#===============================================================================

# Forcefield calculation of rotation profile of a C-C bond in a model peptide

job: scan

# The forcefield calculation requires a geometry in PDB format. However, the
# scan protocol works with .xyz format which can contain multiple frames more
# easily. The solution is to provide a template PDB into which the actual
# coordinates from .xyz scan are loaded
geometry_template: ace-ala-nme.pdb

# The coordinates from the following file are loaded into the template
geometry: scan.xyz

# Scan mode - serial/parallel
scan_mode: parallel
cuby_threads: 4 # four calculations run simultaneously

# The calculation performed on each geometry
calculation:
  job: energy
  interface: amber
  charge: 0
</code></pre></div>
<div class="example"><pre><code>#===============================================================================
# Scan protocol example 3: cartesian grid generator
#===============================================================================

# Scan of the potential around methane, using argon atom as a probe
# PM6-D3 method is used

job: scan
scan_mode: serial

# Geometry: methane + Ar atom
geometry: |
  C    0.000000000   0.000000000   0.000000000
  H    0.626128590   0.626128590  -0.626128590
  H    0.626128590  -0.626128590   0.626128590
  H   -0.626128590   0.626128590   0.626128590
  H   -0.626128590  -0.626128590  -0.626128590
  Ar   0.000000000   0.000000000   3.000000000

#-------------------------------------------------------------------------------
# Grid generator
#-------------------------------------------------------------------------------
scan_generator: grid_xyz
scan_generator_setup:
  # 2D grid, zero in x axis
  grid_x: 0
  grid_y: seq(-7, 0.3, 7) # series from -7 to 7, spacing 0.3 Angstrom
  grid_z: seq(-7, 0.3, 7)
  # Move the 6th atom, Ar
  selection_move: 6
  # van der Waals distance filter - use only points where the minima is likely
  # to occur
  rvdw_min: 0.9
  rvdw_max: 1.2

#-------------------------------------------------------------------------------
# Calculation: PM6-D3
#-------------------------------------------------------------------------------
calculation:
  job: energy
  interface: mopac
  method: pm6
  charge: 0
  modifiers: dispersion3
</code></pre></div>
		</div>
		</div>
	</body>
</html>
